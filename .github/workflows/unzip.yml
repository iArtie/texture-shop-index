name: Procesar archivo de issue

on:
  issue_comment:
    types: [created]

jobs:
  procesar-archivo:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v2

      - name: Verificar comentario "!accept"
        id: verificar-comentario
        run: |
          comentario=$(jq -r .comment.body "${GITHUB_EVENT_PATH}")
          if [[ "$comentario" == "!accept" ]]; then
            echo "::set-output name=accept::true"
          else
            echo "::set-output name=accept::false"
          fi

      - name: Obtener nombre de archivo y descargar
        if: steps.verificar-comentario.outputs.accept == 'true'
        id: obtener-archivo
        run: |
          archivo=$(awk '/^### Drag file here/ {print $NF}' <<< "${{ github.event.issue.body }}")
          curl -o "$archivo" "$(awk '/^### Drag file here/ {print $NF}' <<< "${{ github.event.issue.body }}" | sed 's/.*(//;s/).*//')"

      - name: Crear carpeta "Texture Packs" si no existe
        if: steps.verificar-comentario.outputs.accept == 'true'
        run: |
          mkdir -p "Texture Packs"

      - name: Mover archivo a "Texture Packs"
        if: steps.verificar-comentario.outputs.accept == 'true'
        run: |
          mv "${{ steps.obtener-archivo.outputs.archivo }}" "Texture Packs/"
